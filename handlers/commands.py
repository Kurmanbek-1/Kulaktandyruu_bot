from aiogram import Dispatcher, types
from config import Admins
import buttons

blocked_users = {}


#--------------------------------------------------------------------------------------------------------------------------

async def start(message: types.Message):
    user_id = message.from_user.id
    if message.from_user.id in Admins:
        await message.answer("üöÄ –û –ù–∞—Å:\n\n"
                            "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Kulaktandyruuüëã\n"
                            "–ú–æ—è —Ü–µ–ª—å - —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç—ã–º –¥–ª—è –≤–∞—Å."
                            "\n\n"
                            "üí≥ –ü–ª–∞—Ç–µ–∂–∏:\n"
                            "–£ –º–µ–Ω—è –ø—Ä–æ—Å—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–ø–ª–∞—Ç—ã.\n\n"
                            "ü§ñ –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞:\n"
                            "–ú—ã –Ω–∞ —Å–≤—è–∑–∏ 24/7. –ü–∏—à–∏, –∏ –º—ã –ø–æ–º–æ–∂–µ–º!\n\n"
                            "üìå–í–Ω–∏–º–∞–Ω–∏–µ!\n"
                            "–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—á—Ç–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –±–æ—Ç–∞!\n\n"
                            "‚ö†Ô∏è –í–∞–∂–Ω–æ!\n"
                            "–ù–µ—Ü–µ–ª–µ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã.\n\n"
                            "–ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –∑–∞ –ø–æ–Ω–∏–º–∞–Ω–∏–µ! üöÄ‚ú®\n\n",
                             reply_markup=buttons.StartForAdmin)

    else:
        if user_id in blocked_users:
            await message.reply('–ò–∑–≤–∏–Ω–∏—Ç–µ, –≤—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã. üö´', reply_markup=None)
            return
        else:
            await message.answer("üöÄ –û –ù–∞—Å:\n\n"
                            "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Kulaktandyruuüëã\n"
                            "–ú–æ—è —Ü–µ–ª—å - —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç—ã–º –¥–ª—è –≤–∞—Å."
                            "\n\n"
                            "üí≥ –ü–ª–∞—Ç–µ–∂–∏:\n"
                            "–£ –º–µ–Ω—è –ø—Ä–æ—Å—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–ø–ª–∞—Ç—ã.\n\n"
                            "ü§ñ –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞:\n"
                            "–ú—ã –Ω–∞ —Å–≤—è–∑–∏ 24/7. –ü–∏—à–∏, –∏ –º—ã –ø–æ–º–æ–∂–µ–º!\n\n"
                            "üìå–í–Ω–∏–º–∞–Ω–∏–µ!\n"
                            "–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—á—Ç–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –±–æ—Ç–∞!\n\n"
                            "‚ö†Ô∏è –í–∞–∂–Ω–æ!\n"
                            "–ù–µ—Ü–µ–ª–µ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã.\n\n"
                            "–ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –∑–∞ –ø–æ–Ω–∏–º–∞–Ω–∏–µ! üöÄ‚ú®\n\n",
                                 reply_markup=buttons.OrderForStart)


async def support(message: types.Message):
    await message.answer('–ù–∞—à–∞ —Ç–µ—Ö.–ø–æ–¥–¥–µ—Ä–∂–∫–∞:\n'
                         '@kulaktandyruu_Bishkek', reply_markup=buttons.Start)

#--------------------------------------------------------------------------------------------------------------------------

async def rule(message: types.Message):
    user_id = message.from_user.id

    if user_id in blocked_users:
        await message.reply('–ò–∑–≤–∏–Ω–∏—Ç–µ, –≤—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã. üö´', reply_markup=None)
        return
    else:
        await message.answer("üìå–ü–†–ê–í–ò–õ–ê\n\n"
                             "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!\n"
                             "–ü—Ä–µ–∂–¥–µ —á–µ–º –Ω–∞—á–∞—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –±–æ—Ç–æ–º, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ –Ω–∞—à–∏ –ø—Ä–∞–≤–∏–ª–∞. "
                             "–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –ª—É—á—à–µ –ø–æ–Ω—è—Ç—å, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ—Ç –∏ –∏–∑–±–µ–∂–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω—ã—Ö –Ω–µ–¥–æ—Ä–∞–∑—É–º–µ–Ω–∏–π."
                             "\n\n"
                             "‚ö†Ô∏è –í–∞–∂–Ω–æ:\n"
                             "–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –º–æ–∂–µ—Ç –ø–æ–≤–ª–µ—á—å –∑–∞ —Å–æ–±–æ–π –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –±–æ—Ç–∞."
                             "\n\n"
                             "üõë–í–∞–∫–∞–Ω—Å–∏—è –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —á–µ—Ç–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è—Ö –∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞–º –∏ –∏—Ö –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç—è—Ö. "
                             "–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç–∞–º –ª—É—á—à–µ –ø–æ–Ω—è—Ç—å, –ø–æ–¥—Ö–æ–¥–∏—Ç –ª–∏ –∏–º –¥–∞–Ω–Ω–∞—è –≤–∞–∫–∞–Ω—Å–∏—è."
                             "\n\n"
                             "üõë–ê–≤—Ç–æ—Ä –≤–∞–∫–∞–Ω—Å–∏–∏ –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –±–æ—Ç–∞ –Ω–µ "
                             "–Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ —É—Å–ª–æ–≤–∏—è —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏–ª–∏ –¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–∞–Ω–∏–∏. "
                             "\n\n"
                             "üõë–í—Å–µ —Ä–∞–∑–º–µ—â–∞–µ–º—ã–µ –≤–∞–∫–∞–Ω—Å–∏–∏ –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –¥–µ–π—Å—Ç–≤—É—é—â–∏–º –∑–∞–∫–æ–Ω–∞–º –≤ –æ–±–ª–∞—Å—Ç–∏ —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞. "
                             "–ó–∞–ø—Ä–µ—â–µ–Ω–æ –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –≤–∞–∫–∞–Ω—Å–∏–∏, –Ω–∞—Ä—É—à–∞—é—â–∏–µ –∑–∞–∫–æ–Ω—ã –∏ –Ω–æ—Ä–º—ã."
                             "\n\n"
                             "üõë–õ—é–±—ã–µ –≤–∞–∫–∞–Ω—Å–∏–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –ø—Ä–æ—Ç–∏–≤–æ–∑–∞–∫–æ–Ω–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é, —Ç–∞–∫–æ–π –∫–∞–∫ –ø—Ä–æ—Å—Ç–∏—Ç—É—Ü–∏—è, –Ω–∞—Ä–∫–æ—Ç–æ—Ä–≥–æ–≤–ª—è "
                             "–∏ –¥—Ä—É–≥–∏–µ –Ω–µ–∑–∞–∫–æ–Ω–Ω—ã–µ –≤–∏–¥—ã –±–∏–∑–Ω–µ—Å–∞, –Ω–µ –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è."
                             "\n\n"
                             "üõë–ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤–∞–∫–∞–Ω—Å–∏–π, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏—Ö —Å–æ–±–æ–π —è–≤–Ω—ã–π —Å–ø–∞–º –∏–ª–∏ –æ–±–º–∞–Ω, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–≤–µ–¥–æ–º–æ –ª–æ–∂–Ω—ã–µ "
                             "–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Å –≤—ã—Å–æ–∫–∏–º–∏ –∑–∞—Ä–ø–ª–∞—Ç–∞–º–∏, –Ω–µ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è."
                             "\n\n"
                             "üõë–í–∞–∫–∞–Ω—Å–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å —É–≥—Ä–æ–∑—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å–æ–∏—Å–∫–∞—Ç–µ–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–µ "
                             "—Å–±–æ—Ä –ª–∏—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏), —Å—Ç—Ä–æ–≥–æ –∑–∞–ø—Ä–µ—â–µ–Ω—ã."
                             "\n\n"
                             "üõë–†–∞–±–æ—Ç–∞, —Å–≤—è–∑–∞–Ω–Ω–∞—è —Å –ø–∏—Ä–∞–º–∏–¥–∞–ª—å–Ω—ã–º–∏ —Å—Ö–µ–º–∞–º–∏, –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω—ã–º –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–º (MLM) –∏–ª–∏ –ø–æ–¥–æ–±–Ω—ã–º–∏ "
                             "—Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–∏—Å–∫–∏ –¥–ª—è —Å–æ–∏—Å–∫–∞—Ç–µ–ª–µ–π, –Ω–µ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è."
                             "\n\n"
                             "üõë–ï—Å–ª–∏ –≤–∞—à–∞ —Ä–µ–∫–ª–∞–º–∞ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ —ç—Ç–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º —Ç–æ –≤–∞—à–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏—è –Ω–µ –±—É–¥–µ—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –∏ —Å—Ä–µ–¥—Å—Ç–≤–∞ –≤–æ–∑–≤—Ä–∞—Ç—É –Ω–µ –ø–æ–¥–ª–µ–∂–∏—Ç!"
                             "\n\n\n"
                             "–ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –∑–∞ –≤–Ω–∏–º–∞–Ω–∏–µ –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ!üôÇ\n"
                             "–ú—ã —Ü–µ–Ω–∏–º –≤–∞—à–µ —Å–æ–±–ª—é–¥–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∏ –∂–µ–ª–∞–µ–º –ø—Ä–∏—è—Ç–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–æ—Ç–æ–º.‚úÖ")

#--------------------------------------------------------------------------------------------------------------------------

async def block_user_by_id(message: types.Message):
    if message.from_user.id not in Admins:
        await message.reply('–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã.')
        return

    try:
        user_id_to_block = int(message.text.split(' ')[1])
    except IndexError:
        await message.reply('–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ /block_user <user_ID> –∏–ª–∏ /–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å <user_ID>')
        return
    except ValueError:
        await message.reply('ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º.')
        return

    blocked_users[user_id_to_block] = True
    await message.reply(f'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id_to_block} –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω‚ùóÔ∏è')

#--------------------------------------------------------------------------------------------------------------------------

async def unblock_user_by_id(message: types.Message):
    if message.from_user.id not in Admins:
        await message.reply('–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã.')
        return

    try:
        user_id_to_unblock = int(message.text.split(' ')[1])
    except IndexError:
        await message.reply('–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ /unblock_user <user_ID> –∏–ª–∏ /–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å <user_ID>')
        return
    except ValueError:
        await message.reply('ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º.')
        return

    if blocked_users.get(user_id_to_unblock):
        del blocked_users[user_id_to_unblock]
        await message.reply(f'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id_to_unblock} —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω. ‚úÖ')
    else:
        await message.reply(f'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id_to_unblock} –Ω–µ –±—ã–ª –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω.')

#--------------------------------------------------------------------------------------------------------------------------

async def show_blocked_users(message: types.Message):
    if message.from_user.id not in Admins:
        await message.reply('–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã.')
        return

    if blocked_users:
        blocked_users_list = "\n".join(str(user_id) for user_id in blocked_users.keys())
        await message.reply(f'–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:\n{blocked_users_list}')
    else:
        await message.reply('–ù–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.')

#--------------------------------------------------------------------------------------------------------------------------

async def info_for_block(message: types.Message):
    await message.answer(text="–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ: ‚¨áÔ∏è"
                         "\n\n"
                         "–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞: üö´\n"
                         "/–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å <user_ID>"
                         "\n\n"
                         "–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞: ‚úÖ\n"
                         "/–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å <user_ID>"
                         "\n\n"
                         "‚ùóÔ∏è–û–±—Ä–∞–∑–µ—Ü:\n"
                         "/–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å 213121"
                         )

#--------------------------------------------------------------------------------------------------------------------------

def register_commands(dp: Dispatcher):
    dp.register_message_handler(start, commands=['start'])
    dp.register_message_handler(support, commands=['support'])
    dp.register_message_handler(rule, commands=['rules', '–ø—Ä–∞–≤–∏–ª–∞'])
    dp.register_message_handler(block_user_by_id, commands=['block_user', "–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å"])
    dp.register_message_handler(unblock_user_by_id, commands=['unblock_user', "–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å"])
    dp.register_message_handler(show_blocked_users, commands=['blocked_users', "–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ!"])
    dp.register_message_handler(info_for_block, commands=['–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è!'])
